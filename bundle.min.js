!function(e){var t={};function i(s){if(t[s])return t[s].exports;var a=t[s]={i:s,l:!1,exports:{}};return e[s].call(a.exports,a,a.exports,i),a.l=!0,a.exports}i.m=e,i.c=t,i.d=function(e,t,s){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)i.d(s,a,function(t){return e[t]}.bind(null,a));return s},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}([function(e,t,i){"use strict";i.r(t);class s{constructor(e,t,i,s,a){this.map=i,this.index=t,this.layer=s,this.grid=a,this.alive=!0,this.indexes={head:this.index+1,straight:this.index+2,bent:this.index+3,tail:this.index+4},this.segments=e.map(e=>i.getTile(e[0],e[1],s));let l={get:()=>this.segments[0]};Object.defineProperty(this,"headTile",l);let o={get:()=>this.segments[this.segments.length-1]};Object.defineProperty(this,"tailTile",o),this.segments[0].sorted=!0;let h=this.segments;for(;!h.every(e=>e.sorted);){let e=h.filter(e=>e.sorted),t=h.filter(e=>!e.sorted),i=e[e.length-1];if(!i)return;let s=this.getSnakeNeighbours(i,!1);i.attempted=i.attempted||[0];let a=i.attempted[i.attempted.length-1],l=s.filter(e=>!e.sorted)[a];if(l)t.splice(t.indexOf(l),1),e.push(l),l.sorted=!0,h=e.concat(t);else{e.forEach(e=>e.sorted=!1),e[0].sorted=!0,a>s.length-1||i.attempted.push(a+1),this.segments=e.concat(t);let l=h.splice(h.indexOf(i),1);this.grid.updateTile(l,1)}}this.segments=h,this.update()}moveTo(e){let t=(this.indexes.head-13)/4;if(e===this.headTile)return;let i=e.index===game.edible_types.cake||e.index===game.edible_types.broc||e.index<5;!i&&e.index>game.edible_types.cake&&(i=this.indexes.head===e.index+(4*t+6-t)),this.headTile!==e&&i&&this.getNeighbours().some(t=>t===e)&&this.doMove(e)}doMove(e){let t=5===e.index,i=e.index>5&&e.index<12;this.segments.unshift(e),this.grid.updateTile(e,this.indexes.head),i?game.increaseScore(game.edible_types.cake,e.worldX,e.worldY):this.clearTail(),t&&(this.clearTail(),game.increaseScore(game.edible_types.broc,e.worldX,e.worldY)),this.segments.length<2&&(game.triggerSnakeKilled(),this.destroy()),this.update(e)}destroy(){this.alive=!1,this.clearTail(),this.grid.active_snake=null}getNeighbours(e=this.headTile){if(!this.map.layers.length>0)return;let t=[this.map.getTileAbove(0,e.x,e.y),this.map.getTileBelow(0,e.x,e.y),this.map.getTileLeft(0,e.x,e.y),this.map.getTileRight(0,e.x,e.y)];return t=t.filter(e=>null!=e),t}getDirection(e,t=this.segments[1],i=!1){let s;if(!this.map.layers.length>0)return;let a={above:this.map.getTileAbove(0,t.x,t.y),below:this.map.getTileBelow(0,t.x,t.y),left:this.map.getTileLeft(0,t.x,t.y),right:this.map.getTileRight(0,t.x,t.y)};for(var l in a){if(!l)return;a[l]===e&&(s=l)}return i?this.invertDirection(s):s}rotateTile(e,t){t.rotation="above"===e||"below"===e?1.58:0,t.flipped="below"===e||"right"===e}hasNeighbours(e,t,i){return-1!==e.indexOf(t)&&-1!==e.indexOf(i)}getSnakeNeighbours(e=this.headTile,t=!0){let i=this.getNeighbours(e);if(i)return i.filter(e=>Object.keys(this.indexes).some(t=>e.index===this.indexes[t]))}getConnectedSnakeNeighbours(e=this.headTile,t=!0){let i=this.segments.indexOf(e);return[this.segments[i-1],this.segments[i+1]].filter(e=>null!=e)}invertDirection(e){return"left"==e?"right":"right"==e?"left":"above"==e?"below":"below"==e?"above":void 0}update(e){let t;if(this.alive){if(this.segments.forEach(e=>{let i=this.getConnectedSnakeNeighbours(e);if(i=i.map(t=>this.getDirection(e,t,!0)),t){let i=this.getDirection(t,e);this.rotateTile(i,e)}t=e,this.grid.updateTile(e,this.indexes.bent),2==i.length&&(this.hasNeighbours(i,"above","below")||this.hasNeighbours(i,"left","right"))&&this.grid.updateTile(e,this.indexes.straight),this.hasNeighbours(i,"above","right")&&this.rotateTile("right",e),this.hasNeighbours(i,"above","left")&&this.rotateTile("left",e),this.hasNeighbours(i,"below","right")&&this.rotateTile("below",e),this.hasNeighbours(i,"below","left")&&(e.rotation=3.146,e.flipped=!0)}),e){var i=this.getDirection(e);this.rotateTile(i,this.headTile)}else{let e=this.getSnakeNeighbours().map(e=>this.getDirection(this.headTile,e,!0)),t=this.invertDirection(e[0]);this.rotateTile(t,this.headTile)}this.grid.updateTile(this.headTile,this.indexes.head),this.grid.updateTile(this.tailTile,this.indexes.tail)}}clearTail(){let e=this.segments.pop();this.grid.updateTile(e,1)}}class a{constructor(e){this.size=e.tileSize,this.extra_offset=e.extra_offset,this.offset=e.offset,this.snakes=[]}newLevel(e,t){this.destroyLevel(),this.map=game.add.tilemap("level"+e),"kawaii"==t.theme?this.map.addTilesetImage("tile","kawaii"):this.map.addTilesetImage("tile"),this.layer=this.map.createLayer("Tile Layer 1"),this.layer.cameraOffset={x:this.offset.x,y:this.offset.y},this.layer.crop={x:this.offset.x,y:this.offset.y,width:this.layer.width-this.offset.x,height:this.layer.height-this.offset.y},this.layer.resizeWorld();let i=[].concat.apply([],this.layer.layer.data),s=[];for(var a of i)for(var l of[0,1,2,3,4,5]){let e=4*l+12;if(s[l]=s[l]||[],a.index-1>=e&&a.index-1<e+3){let t=a.index-1==e?"unshift":"push";s[l][t]([a.x,a.y])}}this.snakes=s.map((e,t)=>this.createSnake(e,4*t+12)).filter(e=>void 0!==e)}destroyLevel(){this.snakes.forEach(e=>{e.alive=!1}),this.active_snake=null,this.map&&this.map.destroy(),this.layer&&this.layer.destroy()}createSnake(e,t){if(0!==e.length)return new s(e,t,this.map,this.layer,this)}getSnake(e,t){let i=this.getTile(e,t);if(i&&i.index>1)for(var s of this.snakes)if(s.headTile===i)return s}selectSnake(e,t){this.active_snake=this.getSnake(e,t)}moveSnake(e,t){if(null==this.active_snake)return;let i=this.getTile(e,t);this.active_snake&&i&&this.active_snake.moveTo(i)}getTile(e,t){return e-=this.offset.x,t-=this.offset.y,this.map.getTileWorldXY(e,t,this.size,this.size,this.layer)}getEmptyTiles(){let e=[];return e=e.concat.apply(e,this.layer.layer.data),e.filter(e=>1===e.index)}updateTile(e,t=this.active_snake.headTile.index,i=this.layer){this.map.putTile(t,e.x,e.y,i),e.index=t}createFood(){let e=this.getEmptyTiles(),t=Phaser.ArrayUtils.getRandomItem(e);this.updateTile(t,5)}}var l=[{goal:"collect",spawnFood:!0,count:10},{goal:"collect",spawnFood:!0,count:10},{goal:"collect",spawnFood:!0,count:12},{goal:"kill",spawnFood:!0,spawnCount:1,spawnType:2,count:2},{goal:"collect",spawnFood:!0,count:15,kawaii:!0},{goal:"collect_colored",count:4},{goal:"kill",spawnFood:!0,spawnCount:1,spawnType:2,count:2},{goal:"collect_colored",count:1},{goal:"collect_colored",spawnFood:!0,count:8},{goal:"collect",count:5,kawaii:!0},{goal:"collect_colored",count:1},{goal:"collect",spawnFood:!0,count:20},{goal:"collect_colored",count:8},{goal:"collect",spawnFood:!0,spawnCount:1,chance:70,spawnType:2,count:10},{goal:"collect_colored",count:1,kawaii:!0},{goal:"collect_colored",count:2}];class o{constructor(){this.tileSize=144,this.extra_offset={x:20,y:0},this.offset={x:2*this.tileSize+this.extra_offset.x,y:this.tileSize/8},this.grid=new a({tileSize:this.tileSize,extra_offset:this.extra_offset,offset:this.offset}),this.marker=game.add.graphics(),this.marker.lineStyle(2,16777215,1),this.marker.drawRect(0,0,this.tileSize,this.tileSize),this.score=0,this.level=1,this.levels=l;let e={font:"36px Arial",fill:"#ffffff",align:"center",stroke:"#000000",strokeThickness:6};this.score_text=game.add.text(140,120,"0",e),this.level_text=game.add.text(140,280,"0",e),this.goal_text=game.add.text(140,430,"0",e),this.time_text=game.add.text(140,590,"0",e),this.opt_button=game.add.button(0,657,"opt_button",this.showOptions,this),this.restart_button=game.add.button(100,657,"restart_button",this.startLevel,this),this.score_text.anchor.x=Math.round(.5*this.score_text.width)/this.score_text.width,this.level_text.anchor.x=Math.round(.5*this.level_text.width)/this.level_text.width,this.goal_text.anchor.x=Math.round(.5*this.goal_text.width)/this.goal_text.width,this.time_text.anchor.x=Math.round(.5*this.time_text.width)/this.time_text.width,this.timer=game.time.create(!1),this.timer.loop(1e3,this.updateCounter,this),this.timer.start(),this.sound_enabled=!0,this.normal_theme=!0,this.crumb_emitter=game.add.emitter(game.world.centerX,game.world.centerY),this.crumb_emitter.maxParticleAlpha=1,this.crumb_emitter.minParticleAlpha=.7,this.crumb_emitter.makeParticles("crumb",0,400,1,!1,!1),game.input.onDown.add(this.startDragging,this),game.input.onUp.add(this.stopDragging,this),game.input.addMoveCallback(this.updateMarker,this),game.increaseScore=(e,t,i)=>{this.increaseScore(e,t,i)},game.triggerSnakeKilled=e=>{this.triggerSnakeKilled()},this.startLevel()}startLevel(){let e;this.time_elapsed=0,this.collected=0,this.point_goal=this.levels[this.level-1].count,this.modal_is_open=!1,e=this.levels[this.level-1].kawaii?"kawaii":"normal",e=!this.levels[this.level-1].kawaii&&this.normal_theme?"normal":"kawaii",this.level_text.text=this.level.toString(),this.goal_text.text=`${this.collected} of ${this.point_goal}`,this.time_text.text="0",this.background&&this.background.destroy(),this.background=game.add.image(0,0,e+"_bg").sendToBack(),this.grid.snakes.forEach(e=>{e.alive=!1}),this.grid.newLevel(this.level,{theme:e}),this.foliage&&this.foliage.destroy(),this.foliage=game.add.image(0,0,e+"_foliage").bringToTop(),this.modal&&this.modal.bringToTop(),this.win_button&&this.win_button.destroy()}showOptions(){this.openModal("modal-settings");let e=game.add.button(game.width/2+50,game.height/2+80,null,this.backToMenu,this),t=game.add.button(game.width/2-50,game.height/2+80,null,this.closeModal,this),i=game.add.button(game.width/2+132,game.height/2-70,"switch",this.toggleKawaii,this),s=game.add.button(game.width/2+132,game.height/2+15,"switch",this.toggleSound,this);t.width=150,t.height=50,e.width=150,e.height=50,this.buttons=[t,e,i,s],this.buttons.forEach(e=>{e.anchor.x=.5})}showWinModal(){this.openModal("modal-win"),this.win_animation=game.add.sprite(game.width/2,game.height/2-20,"win"),this.win_animation.anchor.x=.5,this.win_animation.anchor.y=.5,this.win_animation.scale.x=.9,this.win_animation.scale.y=.9,this.win_animation.animations.add("walk").play(8,!0),this.win_button=game.add.button(game.width/2,game.height/2,null,this.startNextLevel,this),this.win_button.width=300,this.win_button.height=300,this.win_button.anchor.x=.5,this.win_button.anchor.y=.5}closeModal(){this.modal&&(this.modal_is_open=!1,this.modal.destroy(),this.buttons&&this.buttons.forEach(e=>{e.destroy()}))}backToMenu(){this.closeModal()}openModal(e){this.modal_is_open=!0,this.modal=game.add.image(0,0,e)}toggleSound(){this.sound_enabled=!this.sound_enabled;let e=this.sound_enabled?0:1;this.buttons[2].frame=e,console.log(this.buttons[2])}toggleKawaii(){this.normal_theme=!this.normal_theme;let e=this.normal_theme?0:1;this.buttons[3].frame=e,console.log(this.buttons[3]),this.startLevel()}startDragging(){this.modal_is_open||this.grid.selectSnake(this.marker.x,this.marker.y)}stopDragging(){this.grid.active_snake=null}triggerSnakeKilled(){"kill"===this.levels[this.level-1].goal&&this.increaseScore(66)}increaseScore(e,t,i){e===game.edible_types.broc||this.launchCrumbs(t,i),(e===game.edible_types.cake&&"collect"==this.levels[this.level-1].goal||e!=game.edible_types.broc&&"collect_colored"==this.levels[this.level-1].goal||66===e&&"kill"==this.levels[this.level-1].goal)&&(this.score+=50,this.score_text.text=this.score.toString(),this.collected++,this.goal_text.text=`${this.collected} of ${this.point_goal}`,this.checkWinCondition()),this.levels[this.level-1].spawnFood&&this.createFood()}checkWinCondition(){this.collected===this.point_goal&&this.showWinModal()}startNextLevel(){this.level++,this.closeModal(),this.win_animation&&this.win_animation.destroy(),this.startLevel()}updateMarker(){if(this.modal_is_open)return;let e=game.input.activePointer;if(!this.grid)return;let t=this.grid.layer.getTileX(e.worldX),i=this.grid.layer.getTileX(e.worldY);this.marker.x=t*this.tileSize+this.extra_offset.x,this.marker.y=i*this.tileSize+this.offset.y,e.isDown&&this.grid.moveSnake(this.marker.x,this.marker.y)}createFood(){let e=this.levels[this.level-1].spawnCount||1,t=this.levels[this.level-1].spawnType||1,i=game.edible_types.cake,s=this.levels[this.level-1].chance||30;2===t&&(i=Phaser.Math.chanceRoll(s)?game.edible_types.cake:game.edible_types.broc);for(var a=0;a<e;a++){let e=this.grid.getEmptyTiles(),t=Phaser.ArrayUtils.getRandomItem(e);t.rotation=0,t.flipped=!1,this.grid.updateTile(t,i)}}launchCrumbs(e,t){e=e+this.offset.x+this.tileSize/2,t+=this.tileSize/2,this.crumb_emitter.x=e,this.crumb_emitter.y=t,game.world.bringToTop(this.crumb_emitter),this.crumb_emitter.start(!0,5e3,30,8)}updateCounter(){this.modal_is_open||(this.time_text.text=this.time_elapsed.toString(),this.time_elapsed++)}}window.game=new Phaser.Game(1334,750,Phaser.AUTO,"game-container",{}),game.state.add("play",class{create(){new o;game.physics.startSystem(Phaser.Physics.ARCADE),this.game.device.desktop||game.input.onDown.add(this.goFull,this),game.edible_types={broc:5,cake:6},game.snake_config={numTiles:4,numTypes:6}}goFull(){game.scale.startFullScreen(!1)}}),game.state.add("load",class{constructor(){this.loadingSprite=null}preload(){this.load.onLoadComplete.addOnce(this.onLoadComplete,this);for(var e=1;e<=16;e++){let t=e;e<10&&(t="0"+e),this.load.tilemap("level"+e,`levels/level_${t}.json`,null,Phaser.Tilemap.TILED_JSON)}this.load.image("tile","images/tile.png"),this.load.image("kawaii","images/kawaii.png"),this.load.image("modal-instructions","images/modal-instructions.png"),this.load.image("modal-settings","images/modal-settings.png"),this.load.image("modal-win","images/modal-win.png"),this.load.image("opt_button","images/opt_button.png"),this.load.image("restart_button","images/restart_button.png"),this.load.spritesheet("switch","images/switch-left.png",70,42),this.load.spritesheet("win","images/win.png",257,247),this.load.image("title","images/title.jpg"),this.load.image("crumb","images/crumb.png"),this.load.image("broc","images/broc.png"),this.load.image("kawaii_bg","images/kawaii_bg.jpg"),this.load.image("kawaii_foliage","images/kawaii_foliage.png"),this.load.image("normal_bg","images/jungle.jpg"),this.load.image("normal_foliage","images/foliage.png")}onLoadComplete(){game.state.start("menu",!0,!1)}}),game.state.add("menu",class{create(){game.add.image(0,0,"title"),game.input.onDown.add((function(){game.state.start("play",!0,!1)}),this)}}),game.state.add("boot",class{preload(){this.load.baseURL="assets/"}create(){this.input.maxPointers=1,this.stage.disableVisibilityChange=!0,game.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,game.scale.fullScreenScaleMode=Phaser.ScaleManager.SHOW_ALL,this.scale.pageAlignHorizontally=!0,this.scale.pageAlignVertically=!0,game.scale.setScreenSize(!0),this.scale.forceOrientation(!0),game.state.start("load",!0,!1)}}),game.state.start("boot")}]);